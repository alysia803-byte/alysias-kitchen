<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alysia's Kitchen ä»Šæ™šé£Ÿä¹œå¥½ï¼Ÿ</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,600;0,700;1,400&family=Noto+Serif+TC:wght@300;400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#1a1209;--paper:#fdf8f1;--warm:#f5ede0;
  --rust:#bf4b1e;--rust-l:#e06b3a;
  --jade:#2d7d62;--jade-l:#4aaa87;
  --gold:#c4851a;--gold-l:#e8b84b;
  --violet:#6b4fa0;--violet-l:#9b7fd4;
  --blue:#1e6fa0;--blue-l:#3a9fd4;
  --muted:#8a7260;--border:#e2d4c0;
  --shadow:rgba(26,18,9,0.10);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:var(--paper);color:var(--ink);min-height:100vh;overflow-x:hidden;}

/* â”€â”€ HEADER â”€â”€ */
.site-header{background:var(--ink);padding:2rem 1.5rem 1.6rem;text-align:center;position:relative;overflow:hidden;}
.site-header::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--rust),var(--gold),var(--jade),var(--violet));}
.header-kicker{font-size:.65rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold-l);margin-bottom:.5rem;font-weight:500;}
.header-h1{font-family:'Fraunces',serif;font-size:clamp(2rem,6vw,3rem);color:var(--paper);line-height:1;}
.header-h1 em{font-style:italic;color:var(--gold-l);}
.header-sub{font-family:'Noto Serif TC',serif;font-size:.82rem;color:var(--muted);margin-top:.5rem;font-weight:300;}
.date-badge{display:inline-block;margin-top:.9rem;padding:.3rem .9rem;border:1px solid rgba(255,255,255,.12);border-radius:50px;font-size:.72rem;color:rgba(255,255,255,.5);letter-spacing:.04em;}

/* â”€â”€ LAYOUT â”€â”€ */
.layout{max-width:1040px;margin:0 auto;padding:1.5rem 1rem 4rem;display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;align-items:start;}
@media(max-width:700px){.layout{grid-template-columns:1fr;}}

/* â”€â”€ PANELS â”€â”€ */
.panel{background:white;border:1px solid var(--border);border-radius:18px;overflow:hidden;box-shadow:0 2px 16px var(--shadow);}
.panel-head{padding:.9rem 1.2rem;display:flex;align-items:center;gap:.6rem;border-bottom:1px solid var(--border);background:#fdf8f1;}
.panel-head-icon{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1rem;}
.panel-head-title{font-family:'Noto Serif TC',serif;font-size:.8rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;}
.panel-body{padding:1.1rem 1.1rem 1.3rem;}

/* â”€â”€ NAME STEP â”€â”€ */
.name-label{font-family:'Noto Serif TC',serif;font-size:.78rem;font-weight:600;color:var(--muted);margin-bottom:.5rem;display:block;}
.name-row{display:flex;gap:.5rem;}
.name-input{flex:1;padding:.7rem 1rem;border:1.5px solid var(--border);border-radius:10px;font-family:'Noto Serif TC',serif;font-size:.95rem;color:var(--ink);background:var(--warm);outline:none;transition:border-color .2s;}
.name-input:focus{border-color:var(--rust);}
.name-input::placeholder{color:var(--muted);opacity:.7;}
.btn-go{padding:.7rem 1.1rem;background:var(--rust);color:white;border:none;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:.88rem;font-weight:600;cursor:pointer;transition:background .2s,transform .1s;white-space:nowrap;}
.btn-go:hover{background:var(--rust-l);}
.btn-go:active{transform:scale(.97);}

/* â”€â”€ MENU â”€â”€ */
.menu-wrap{display:none;animation:fadeUp .35s ease both;}
.menu-wrap.on{display:block;}
.greeter{font-family:'Fraunces',serif;font-size:1.15rem;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:1px dashed var(--border);}
.greeter em{font-style:italic;color:var(--rust);}

/* Category header */
.cat-label{display:flex;align-items:center;gap:.5rem;margin:1.1rem 0 .55rem;}
.cat-label-text{font-family:'Noto Serif TC',serif;font-size:.7rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;}
.cat-pasta .cat-label-text{color:var(--rust);}
.cat-cant .cat-label-text{color:var(--jade);}
.cat-soup .cat-label-text{color:var(--blue);}
.cat-custom .cat-label-text{color:var(--violet);}

/* Dish card */
.dish{display:flex;align-items:center;gap:.65rem;padding:.6rem .7rem;border-radius:10px;border:1.5px solid transparent;cursor:pointer;transition:all .18s;margin-bottom:.35rem;background:var(--warm);user-select:none;-webkit-tap-highlight-color:transparent;position:relative;}
.dish:hover{border-color:var(--border);background:var(--paper);}
.dish.sel{border-color:var(--rust);background:#fff7f4;box-shadow:0 2px 10px rgba(191,75,30,.1);}
.cat-cant .dish.sel{border-color:var(--jade);background:#f3fbf8;box-shadow:0 2px 10px rgba(45,125,98,.1);}
.cat-soup .dish.sel{border-color:var(--blue);background:#f0f7fc;box-shadow:0 2px 10px rgba(30,111,160,.1);}
.cat-custom .dish.sel{border-color:var(--violet);background:#f7f4fc;box-shadow:0 2px 10px rgba(107,79,160,.1);}
.dish-em{font-size:1.25rem;flex-shrink:0;width:1.8rem;text-align:center;}
.dish-text{flex:1;min-width:0;}
.dish-zh{font-family:'Noto Serif TC',serif;font-size:.86rem;font-weight:600;color:var(--ink);line-height:1.25;}
.dish-en{font-size:.68rem;color:var(--muted);margin-top:1px;}
.dish-sub{font-size:.62rem;font-style:italic;margin-top:2px;}
.cat-pasta .dish-sub{color:var(--rust);}
.cat-cant .dish-sub{color:var(--jade);}
.cat-soup .dish-sub{color:var(--blue);}
.cat-custom .dish-sub{color:var(--violet);}

/* Note */
.note-area{display:none;width:100%;margin-top:.4rem;padding:.38rem .55rem;border:1px solid var(--border);border-radius:7px;font-family:'Noto Serif TC',serif;font-size:.7rem;color:var(--ink);background:white;resize:none;height:38px;outline:none;transition:border-color .18s;}
.note-area:focus{border-color:var(--rust);}
.note-area::placeholder{color:var(--muted);opacity:.6;}
.dish.sel .note-area{display:block;}

/* Qty + checkbox */
.dish-right{display:flex;align-items:center;gap:.35rem;flex-shrink:0;}
.dish-box{width:20px;height:20px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:.6rem;color:transparent;transition:all .18s;}
.dish.sel .dish-box{background:var(--rust);border-color:var(--rust);color:white;display:none;}
.cat-cant .dish.sel .dish-box{background:var(--jade);border-color:var(--jade);}
.cat-soup .dish.sel .dish-box{background:var(--blue);border-color:var(--blue);}
.cat-custom .dish.sel .dish-box{background:var(--violet);border-color:var(--violet);}
.qty-row{display:none;align-items:center;gap:.3rem;}
.dish.sel .qty-row{display:flex;}
.qbtn{width:23px;height:23px;border-radius:50%;border:1.5px solid var(--border);background:white;color:var(--ink);font-size:.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:border-color .15s;line-height:1;font-family:'DM Sans',sans-serif;}
.qbtn:hover{border-color:var(--rust);color:var(--rust);}
.qnum{font-size:.82rem;font-weight:600;min-width:13px;text-align:center;font-family:'DM Sans',sans-serif;}

/* Delete custom dish button */
.btn-del-dish{position:absolute;right:-.35rem;top:-.35rem;width:18px;height:18px;border-radius:50%;background:var(--rust);color:white;border:none;cursor:pointer;font-size:.62rem;display:none;align-items:center;justify-content:center;line-height:1;z-index:2;}
.dish.custom-dish:hover .btn-del-dish{display:flex;}

/* â”€â”€ ADD DISH FORM â”€â”€ */
.add-dish-section{margin-top:1rem;padding:1rem;background:linear-gradient(135deg,#f7f4fc,#f0ebfa);border:1.5px dashed var(--violet-l);border-radius:12px;}
.add-dish-title{font-family:'Noto Serif TC',serif;font-size:.75rem;font-weight:700;color:var(--violet);margin-bottom:.7rem;letter-spacing:.06em;}
.add-dish-row{display:grid;grid-template-columns:2.5rem 1fr 1fr;gap:.45rem;margin-bottom:.45rem;}
.add-dish-row input,.add-dish-row select{padding:.55rem .7rem;border:1.5px solid var(--border);border-radius:8px;font-family:'Noto Serif TC',serif;font-size:.8rem;color:var(--ink);background:white;outline:none;transition:border-color .2s;width:100%;}
.add-dish-row input:focus,.add-dish-row select:focus{border-color:var(--violet);}
.add-dish-row input::placeholder{color:var(--muted);opacity:.6;}
.add-dish-hint{font-size:.65rem;color:var(--muted);margin-bottom:.5rem;font-style:italic;}
.btn-add-dish{width:100%;padding:.6rem;background:var(--violet);color:white;border:none;border-radius:8px;font-family:'Noto Serif TC',serif;font-size:.82rem;font-weight:600;cursor:pointer;transition:opacity .2s;letter-spacing:.04em;}
.btn-add-dish:hover{opacity:.88;}

/* â”€â”€ SUBMIT â”€â”€ */
.btn-submit{width:100%;margin-top:1rem;padding:.9rem;background:var(--ink);color:var(--paper);border:none;border-radius:12px;font-family:'Noto Serif TC',serif;font-size:.95rem;font-weight:700;cursor:pointer;letter-spacing:.04em;transition:background .2s,transform .1s;}
.btn-submit:hover{background:#2e2316;}
.btn-submit:active{transform:scale(.99);}
.btn-submit:disabled{opacity:.35;cursor:not-allowed;transform:none;}

/* â”€â”€ RIGHT BOARD â”€â”€ */
.board-panel{position:sticky;top:1.2rem;}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--jade);animation:pulse 2s infinite;flex-shrink:0;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.5;transform:scale(.8);}}
.board-meta{font-size:.7rem;color:var(--muted);margin-left:auto;}
.btn-clear-all{font-size:.7rem;color:var(--muted);background:none;border:none;cursor:pointer;text-decoration:underline;margin-left:.5rem;}
.btn-clear-all:hover{color:var(--rust);}

/* Popularity */
.section-lbl{font-family:'Noto Serif TC',serif;font-size:.68rem;font-weight:700;color:var(--muted);letter-spacing:.1em;text-transform:uppercase;margin-bottom:.55rem;}
.pop-item{display:flex;align-items:center;gap:.45rem;margin-bottom:.4rem;}
.pop-em{font-size:.88rem;flex-shrink:0;}
.pop-name{font-family:'Noto Serif TC',serif;font-size:.76rem;font-weight:600;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pop-bar-wrap{width:60px;height:5px;background:var(--warm);border-radius:3px;overflow:hidden;flex-shrink:0;}
.pop-bar{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--rust),var(--gold));transition:width .4s ease;}
.pop-count{font-size:.68rem;font-weight:600;color:var(--rust);width:12px;text-align:right;flex-shrink:0;}

/* Order cards */
.order-card{background:var(--warm);border:1px solid var(--border);border-radius:11px;padding:.65rem .85rem;margin-bottom:.5rem;position:relative;animation:slideIn .3s ease both;overflow:hidden;}
.order-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:2px 0 0 2px;}
.order-card:nth-child(odd)::before{background:var(--rust);}
.order-card:nth-child(even)::before{background:var(--jade);}
.order-person{font-family:'Noto Serif TC',serif;font-size:.7rem;font-weight:700;color:var(--muted);margin-bottom:.38rem;}
.oi-row{display:flex;align-items:flex-start;gap:.38rem;padding:.22rem 0;border-top:1px dashed var(--border);}
.oi-row:first-of-type{border-top:none;}
.oi-em{font-size:.9rem;flex-shrink:0;}
.oi-body{flex:1;min-width:0;}
.oi-name{font-family:'Noto Serif TC',serif;font-size:.78rem;color:var(--ink);}
.oi-qty{font-size:.65rem;color:var(--muted);}
.oi-note{font-size:.65rem;color:var(--rust);font-style:italic;margin-top:1px;}
.order-time{font-size:.6rem;color:var(--muted);text-align:right;margin-top:.38rem;}
.btn-del-order{position:absolute;top:.45rem;right:.45rem;background:none;border:none;cursor:pointer;font-size:.7rem;color:var(--border);padding:.1rem .28rem;border-radius:4px;transition:color .15s;}
.btn-del-order:hover{color:var(--rust);}

/* Empty */
.empty{text-align:center;padding:2rem 1rem;color:var(--muted);}
.empty i{font-size:2rem;display:block;margin-bottom:.5rem;}
.empty p{font-family:'Noto Serif TC',serif;font-size:.82rem;}

/* Reset info */
.reset-info{margin-top:.9rem;padding:.55rem .85rem;background:var(--warm);border-radius:9px;font-size:.68rem;color:var(--muted);text-align:center;border:1px solid var(--border);}
.reset-info strong{color:var(--rust);}

/* Cook summary */
.cook-panel{margin-top:.9rem;background:var(--ink);border-radius:13px;overflow:hidden;}
.cook-head{padding:.6rem 1rem;font-family:'Noto Serif TC',serif;font-size:.68rem;font-weight:700;color:var(--gold-l);letter-spacing:.12em;text-transform:uppercase;border-bottom:1px solid rgba(255,255,255,.07);}
.cook-row{display:flex;justify-content:space-between;align-items:center;padding:.42rem 1rem;border-top:1px solid rgba(255,255,255,.05);}
.cook-row:first-of-type{border-top:none;}
.cook-name{font-family:'Noto Serif TC',serif;font-size:.78rem;color:rgba(255,255,255,.85);display:flex;align-items:center;gap:.38rem;}
.cook-qty{font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:600;color:var(--gold-l);}

/* Toast */
.toast{position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%) translateY(5rem);background:var(--ink);color:var(--paper);padding:.65rem 1.35rem;border-radius:50px;font-family:'Noto Serif TC',serif;font-size:.82rem;box-shadow:0 8px 30px rgba(0,0,0,.22);transition:transform .38s cubic-bezier(.34,1.56,.64,1);z-index:999;white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);}

/* Modal */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:200;align-items:center;justify-content:center;}
.modal-bg.open{display:flex;}
.modal{background:white;border-radius:16px;padding:1.5rem;max-width:360px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.25);animation:fadeUp .28s ease both;}
.modal h3{font-family:'Fraunces',serif;font-size:1.15rem;margin-bottom:.25rem;}
.modal p{font-size:.78rem;color:var(--muted);margin-bottom:1.1rem;font-family:'Noto Serif TC',serif;}
.modal-btns{display:flex;gap:.5rem;margin-top:1rem;}
.modal-btns button{flex:1;padding:.7rem;border:none;border-radius:9px;font-family:'Noto Serif TC',serif;font-size:.85rem;font-weight:600;cursor:pointer;transition:opacity .18s;}
.modal-btns .btn-cancel{background:var(--warm);color:var(--muted);}
.modal-btns .btn-confirm{background:var(--rust);color:white;}
.modal-btns button:hover{opacity:.85;}

@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}
@keyframes slideIn{from{opacity:0;transform:translateX(-8px);}to{opacity:1;transform:translateX(0);}}

/* Divider between sections */
.section-sep{margin:1rem 0 .2rem;display:flex;align-items:center;gap:.5rem;}
.section-sep::before,.section-sep::after{content:'';flex:1;height:1px;background:var(--border);}
</style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
  <div class="header-kicker">Alysia's Kitchen Â· å®¶åº­å»šæˆ¿</div>
  <h1 class="header-h1">ä»Šæ™šé£Ÿä¹œ<em>å¥½</em>ï¼Ÿ</h1>
  <p class="header-sub">Alysia's Kitchen Â· Place your dinner order &amp; see what everyone wants</p>
  <div class="date-badge" id="dateBadge">â€”</div>
</header>

<div class="layout">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LEFT: ORDER FORM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel">
  <div class="panel-head">
    <div class="panel-head-icon" style="background:rgba(191,75,30,.1)">âœï¸</div>
    <div class="panel-head-title" style="color:var(--rust)">é»èœ Â· Place Order</div>
  </div>
  <div class="panel-body">

    <!-- NAME -->
    <div id="nameStep">
      <label class="name-label">ä½ ä¿‚é‚Šå€‹ï¼Ÿ Â· Who are you?</label>
      <div class="name-row">
        <input id="nameIn" class="name-input" type="text" placeholder="Your name ä½ çš„åå­—" maxlength="20"/>
        <button class="btn-go" onclick="startOrder()">é–‹å§‹ â†’</button>
      </div>
    </div>

    <!-- MENU (shown after name) -->
    <div id="menuWrap" class="menu-wrap">
      <div class="greeter" id="greeter"></div>

      <!-- â”€â”€ æ„ç²‰ PASTA â”€â”€ -->
      <div class="cat-pasta" id="catPasta">
        <div class="cat-label">
          <span style="font-size:1rem">ğŸ</span>
          <span class="cat-label-text">æ„ç²‰ Â· Pasta</span>
        </div>
        <!-- dishes injected by JS -->
      </div>

      <!-- â”€â”€ å»£æ±èœ CANTONESE â”€â”€ -->
      <div class="cat-cant" id="catCant">
        <div class="cat-label">
          <span style="font-size:1rem">ğŸ¥¢</span>
          <span class="cat-label-text">å»£æ±èœ Â· Cantonese</span>
        </div>
        <!-- dishes injected by JS -->
      </div>

      <!-- â”€â”€ æ¹¯ SOUPS â”€â”€ -->
      <div class="cat-soup" id="catSoup">
        <div class="cat-label">
          <span style="font-size:1rem">ğŸ²</span>
          <span class="cat-label-text">æ¹¯ Â· Soups</span>
        </div>
        <!-- dishes injected by JS -->
      </div>

      <!-- â”€â”€ è‡ªè¨‚èœå¼ CUSTOM â”€â”€ -->
      <div class="cat-custom" id="catCustom" style="display:none">
        <div class="cat-label">
          <span style="font-size:1rem">â­</span>
          <span class="cat-label-text">è‡ªè¨‚èœå¼ Â· Custom Dishes</span>
        </div>
        <!-- custom dishes injected by JS -->
      </div>

      <!-- â”€â”€ ADD NEW DISH â”€â”€ -->
      <div class="section-sep"><span style="font-size:.68rem;color:var(--muted);white-space:nowrap">â• åŠ æ–°èœå¼ Add Dish</span></div>
      <div class="add-dish-section">
        <div class="add-dish-title">ğŸ’¡ åŠ å…¥æ–°èœå¼ä¸¦å„²å­˜ Â· Add &amp; save a new dish</div>
        <div class="add-dish-hint">åŠ å…¥å¾Œæ°¸ä¹…ä¿å­˜ï¼Œä¸‹æ¬¡ç¹¼çºŒå¯ä»¥æ€ Â· Saved permanently for future orders</div>
        <div class="add-dish-row">
          <input id="newEmoji" type="text" placeholder="ğŸœ" maxlength="3" style="text-align:center;font-size:1.2rem;padding:.4rem .3rem;"/>
          <input id="newZh" type="text" placeholder="ä¸­æ–‡èœå"/>
          <input id="newEn" type="text" placeholder="English name (optional)"/>
        </div>
        <div class="add-dish-row" style="grid-template-columns:1fr 1fr;">
          <select id="newCat">
            <option value="pasta">æ„ç²‰ Pasta</option>
            <option value="cant">å»£æ±èœ Cantonese</option>
            <option value="soup">æ¹¯ Soup</option>
            <option value="custom">å…¶ä»– Other</option>
          </select>
          <input id="newSub" type="text" placeholder="é…æ–™æè¿° e.g. basilÂ·cheese"/>
        </div>
        <button class="btn-add-dish" onclick="addCustomDish()">ï¼‹ åŠ å…¥ä¸¦å„²å­˜ Add &amp; Save</button>
      </div>

      <button class="btn-submit" id="subBtn" disabled onclick="submitOrder()">
        è«‹é¸æ“‡èœå¼ Â· Select dishes first
      </button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RIGHT: ORDER BOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel board-panel">
  <div class="panel-head">
    <div class="live-dot"></div>
    <div class="panel-head-icon" style="background:rgba(45,125,98,.1)">ğŸ“‹</div>
    <div class="panel-head-title" style="color:var(--jade)">ä»Šæ—¥è¨‚å–® Â· Today's Orders</div>
    <div class="board-meta" id="boardMeta">0 äºº</div>
    <button class="btn-clear-all" onclick="clearAllOrders()">æ¸…é™¤å…¨éƒ¨</button>
  </div>
  <div class="panel-body">

    <div id="popSection" style="display:none;margin-bottom:1.1rem;">
      <div class="section-lbl">ğŸ”¥ æœ€å¤šäººé» Â· Most Popular</div>
      <div id="popList"></div>
    </div>

    <div id="ordersWrap">
      <div class="section-lbl" id="ordersLbl" style="display:none">ğŸ‘¥ å„äººè¨‚å–® Â· Everyone's Order</div>
      <div id="orderCards"></div>
    </div>

    <div class="empty" id="emptyState">
      <i>ğŸ½ï¸</i>
      <p>æœªæœ‰è¨‚å–® Â· No orders yet<br><span style="font-size:.7rem;opacity:.6">Be the first!</span></p>
    </div>

    <div class="reset-info">
      ğŸ•› è¨‚å–®æ¯æ—¥è‡ªå‹•æ¸…é™¤ Â· Orders auto-reset daily<br>
      <strong id="resetTime">â€”</strong>
    </div>
  </div>

  <div class="cook-panel" id="cookPanel" style="display:none">
    <div class="cook-head">ğŸ‘¨â€ğŸ³ å»šå¸«ç¸½è¦½ Â· Cook's Summary</div>
    <div id="cookList"></div>
  </div>
</div>

</div><!-- /layout -->

<!-- Confirm delete custom dish modal -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3>åˆªé™¤èœå¼ï¼ŸRemove dish?</h3>
    <p id="modalMsg">ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™å€‹è‡ªè¨‚èœå¼ï¼Ÿ<br>This custom dish will be permanently removed.</p>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal()">å–æ¶ˆ Cancel</button>
      <button class="btn-confirm" onclick="confirmDeleteDish()">åˆªé™¤ Delete</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA DEFINITIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const BUILTIN_PASTA = [
  {id:'rose',      zh:'ç«ç‘°èŒ„æ±å¿Œå»‰æ„ç²‰',  en:'RosÃ© Creamy Tomato Pasta',  emoji:'ğŸŒ¹', sub:'tomato cream Â· rosÃ© sauce'},
  {id:'bolognese', zh:'è‚‰é†¬æ„ç²‰',           en:'Spaghetti Bolognese',        emoji:'ğŸ', sub:'beef ragÃ¹ Â· tomato'},
  {id:'carbonara', zh:'å¡é‚¦æ‹¿æ„ç²‰',         en:'Spaghetti Carbonara',        emoji:'ğŸ§€', sub:'egg Â· pancetta Â· pecorino'},
  {id:'aglio',     zh:'è’œè“‰è¾£æ¤’æ„ç²‰',       en:'Aglio e Olio',               emoji:'ğŸ§„', sub:'garlic Â· chili Â· olive oil'},
  {id:'pesto',     zh:'é’é†¬æ„ç²‰',           en:'Pesto Pasta',                emoji:'ğŸŒ¿', sub:'basil Â· pine nuts Â· parmesan'},
  {id:'seafood',   zh:'æµ·é®®æ„ç²‰',           en:'Seafood Pasta',              emoji:'ğŸ¦', sub:'prawn Â· squid Â· clam'},
  {id:'saltedyolk',zh:'å’¸è›‹é»ƒèŠå£«æ„ç²‰',    en:'Salted Egg Yolk Cheese Pasta',emoji:'ğŸ¥š', sub:'salted egg yolk Â· cheese sauce'},
  {id:'currysatay',zh:'å’–å“©æ²™èŒ¶æ„ç²‰',       en:'Curry Satay Pasta',          emoji:'ğŸ›', sub:'curry Â· satay Â· coconut'},
  {id:'truffle',   zh:'é»‘æ¾éœ²è˜‘è‡æ„ç²‰',     en:'Black Truffle Mushroom Pasta',emoji:'ğŸ„', sub:'truffle oil Â· porcini Â· cream'},
];

const BUILTIN_CANT = [
  {id:'sweetsour',   zh:'å’•åš•è‚‰',           en:'Sweet & Sour Pork',          emoji:'ğŸ–', sub:'pineapple Â· bell pepper'},
  {id:'steamfish',   zh:'æ¸…è’¸é­š',           en:'Steamed Fish',               emoji:'ğŸŸ', sub:'soy Â· ginger Â· spring onion'},
  {id:'gingerbeef',  zh:'è–‘è”¥ç‚’ç‰›è‚‰',       en:'Ginger & Spring Onion Beef', emoji:'ğŸ¥©', sub:'ginger Â· spring onion'},
  {id:'eggtomato',   zh:'ç•ªèŒ„ç‚’è›‹',         en:'Tomato & Scrambled Egg',     emoji:'ğŸ…', sub:'tomato Â· egg'},
  {id:'vegstir',     zh:'ç‚’é’èœ',           en:'Stir-fried Vegetables',      emoji:'ğŸ¥¬', sub:'seasonal greens'},
  {id:'oysterchk',   zh:'è ”æ²¹é›',           en:'Oyster Sauce Chicken',       emoji:'ğŸ—', sub:'oyster sauce Â· ginger Â· sesame'},
  {id:'shrimptofu',  zh:'è¦ä»è±†è…',         en:'Prawn & Tofu',               emoji:'ğŸ¥›', sub:'silken tofu Â· prawn Â· soy'},
  {id:'eggplant',    zh:'é­šé¦™èŒ„å­',         en:'Spicy Garlic Aubergine',     emoji:'ğŸ†', sub:'garlic Â· chili bean paste'},
  {id:'threecupchk', zh:'ä¸‰æ¯é›',           en:'Three Cup Chicken',          emoji:'ğŸ—', sub:'soy Â· sesame oil Â· rice wine Â· basil'},
  {id:'redbrtofu',   zh:'ç´…ç‡’è±†è…',         en:'Red-Braised Tofu',           emoji:'ğŸŸ«', sub:'braised Â· soy Â· oyster sauce'},
  {id:'garlicpork',  zh:'è’œè‹”ç‚’è±¬é ¸è‚‰',     en:'Garlic Shoot & Pork Jowl',   emoji:'ğŸ·', sub:'garlic shoot Â· pork neck Â· soy'},
  {id:'silvereggspr',zh:'é‡‘éŠ€è›‹è±†è‹—',       en:'Gold & Silver Egg Sprouts',  emoji:'ğŸ¥¬', sub:'century egg Â· salted egg Â· pea shoots'},
  {id:'saltedshrimp',zh:'å’¸è›‹é»ƒç„—å¤§è¦',     en:'Salted Egg Yolk Baked Prawn',emoji:'ğŸ¦', sub:'salted egg yolk Â· butter Â· curry leaf'},
  {id:'tsuribs',     zh:'ç³–é†‹æ’éª¨',         en:'Sweet & Sour Spare Ribs',    emoji:'ğŸ¥©', sub:'vinegar Â· sugar Â· soy'},
  {id:'gingeroyster',zh:'è–‘è”¥ç‚’è ”',         en:'Ginger & Spring Onion Oyster',emoji:'ğŸ¦ª', sub:'fresh oyster Â· ginger Â· spring onion'},
  {id:'garlicveg',   zh:'è’œè“‰ç‚’èœ',         en:'Garlic Stir-fried Greens',   emoji:'ğŸ¥¦', sub:'garlic Â· seasonal greens'},
  {id:'curry',       zh:'å’–å“©ç‰›è…©/é›ç¿¼',    en:'Curry Beef Brisket / Chicken Wings',emoji:'ğŸ›', sub:'curry Â· coconut milk Â· potato'},
];

const BUILTIN_SOUP = [
  {id:'beefbrisket', zh:'ç•ªèŒ„è–¯ä»”ç‰›è…©æ¹¯',   en:'Tomato Potato Beef Brisket Soup', emoji:'ğŸ²', sub:'beef brisket Â· tomato Â· potato'},
  {id:'pearsoup',    zh:'è±¬å±•é›ªæ¢¨æ¹¯',       en:'Pork Shank & Snow Pear Soup',     emoji:'ğŸµ', sub:'pork shank Â· snow pear Â· dates'},
  {id:'scallopsoup', zh:'å¹²è²å†¬ç“œæ¹¯',       en:'Scallop & Winter Melon Soup',     emoji:'ğŸ¥£', sub:'dried scallop Â· winter melon'},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE CONFIG â€” replace with yours!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FIREBASE_CONFIG = {
  apiKey:            "AIzaSyDmEO69ygkujOJUnCxTGk48CraBAt34RN0",
  authDomain:        "alysias-kitchen.firebaseapp.com",
  projectId:         "alysias-kitchen",
  storageBucket:     "alysias-kitchen.firebasestorage.app",
  messagingSenderId: "690549893272",
  appId:             "1:690549893272:web:65f4b90791d94e3fbbc8ed",
  measurementId:     "G-ZBWNQNGX9Z"
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let orders       = [];
let customDishes = [];
let currentName  = '';
let pendingDeleteId = null;
let db = null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function todayStr() {
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE INIT & LISTENERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function initFirebase() {
  // Show connecting state
  document.getElementById('boardMeta').textContent = 'é€£ç·šä¸­â€¦';

  const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js');
  const { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, query, where, getDocs, writeBatch }
    = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');

  const app = initializeApp(FIREBASE_CONFIG);
  db = getFirestore(app);

  // â”€â”€ Listen to today's orders in real-time â”€â”€
  const today = todayStr();
  const ordersRef = collection(db, 'orders');
  const todayQuery = query(ordersRef, where('date', '==', today));

  onSnapshot(todayQuery, snap => {
    orders = snap.docs.map(d => d.data()).filter(o => o.date === todayStr());
    orders.sort((a,b) => (a.ts||0) - (b.ts||0));
    renderBoard();
    updateDate();
  }, err => {
    console.error('Firestore orders error:', err);
    // Fallback: listen to all orders and filter client-side
    onSnapshot(ordersRef, snap => {
      orders = snap.docs.map(d => d.data()).filter(o => o.date === todayStr());
      orders.sort((a,b) => (a.ts||0) - (b.ts||0));
      renderBoard();
      updateDate();
    });
  });

  // â”€â”€ Listen to custom dishes in real-time â”€â”€
  const customRef = collection(db, 'customDishes');
  onSnapshot(customRef, snap => {
    customDishes = snap.docs.map(d => d.data());
    renderMenu();
  });

  // â”€â”€ Midnight auto-purge old orders â”€â”€
  scheduleMidnightReset(db, ordersRef);
}

async function saveOrder(order) {
  const { getFirestore, collection, doc, setDoc }
    = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
  const ref = doc(collection(db, 'orders'), String(order.id));
  await setDoc(ref, order);
}

async function removeOrder(id) {
  const { getFirestore, collection, doc, deleteDoc }
    = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
  await deleteDoc(doc(collection(db, 'orders'), String(id)));
}

async function clearTodayOrders() {
  const { collection, query, where, getDocs, writeBatch, doc }
    = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
  const today = todayStr();
  const q = query(collection(db, 'orders'), where('date','==', today));
  const snap = await getDocs(q);
  const batch = writeBatch(db);
  snap.docs.forEach(d => batch.delete(d.ref));
  await batch.commit();
}

async function saveCustomDish(dish) {
  const { collection, doc, setDoc }
    = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
  await setDoc(doc(collection(db, 'customDishes'), dish.id), dish);
}

async function removeCustomDish(id) {
  const { collection, doc, deleteDoc }
    = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
  await deleteDoc(doc(collection(db, 'customDishes'), id));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD ALL DISHES MAP (for board lookups)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildDishMap() {
  const map = {};
  [...BUILTIN_PASTA, ...BUILTIN_CANT, ...BUILTIN_SOUP, ...customDishes].forEach(d => { map[d.id] = d; });
  return map;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER MENU DISHES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function makeDishCard(d, catClass, isCustom) {
  const div = document.createElement('div');
  div.className = 'dish' + (isCustom ? ' custom-dish' : '');
  div.dataset.id = d.id;
  div.onclick = function(){ toggle(this); };
  div.innerHTML = `
    ${isCustom ? `<button class="btn-del-dish" title="åˆªé™¤" onclick="askDeleteDish(event,'${d.id}')">âœ•</button>` : ''}
    <div class="dish-em">${d.emoji||'ğŸ½ï¸'}</div>
    <div class="dish-text">
      <div class="dish-zh">${d.zh}</div>
      ${d.en ? `<div class="dish-en">${d.en}</div>` : ''}
      ${d.sub ? `<div class="dish-sub">${d.sub}</div>` : ''}
      <textarea class="note-area" placeholder="å‚™æ³¨ e.g. å°‘è¾£ã€å¤šè‚‰â€¦" onclick="sp(event)"></textarea>
    </div>
    <div class="dish-right">
      <div class="qty-row">
        <button class="qbtn" onclick="adjQty(this,-1,event)">âˆ’</button>
        <span class="qnum">1</span>
        <button class="qbtn" onclick="adjQty(this,1,event)">+</button>
      </div>
      <div class="dish-box">âœ“</div>
    </div>`;
  return div;
}

function renderMenu() {
  const pasta   = document.getElementById('catPasta');
  const cant    = document.getElementById('catCant');
  const soup    = document.getElementById('catSoup');
  const custom  = document.getElementById('catCustom');

  // Clear old dishes (keep category header)
  [...pasta.querySelectorAll('.dish')].forEach(e=>e.remove());
  [...cant.querySelectorAll('.dish')].forEach(e=>e.remove());
  [...soup.querySelectorAll('.dish')].forEach(e=>e.remove());
  [...custom.querySelectorAll('.dish')].forEach(e=>e.remove());

  // Builtin pasta + custom pasta
  const pastaCustom = customDishes.filter(d=>d.cat==='pasta');
  [...BUILTIN_PASTA, ...pastaCustom].forEach(d => pasta.appendChild(makeDishCard(d,'cat-pasta', pastaCustom.includes(d))));

  // Builtin cantonese + custom cantonese
  const cantCustom = customDishes.filter(d=>d.cat==='cant');
  [...BUILTIN_CANT, ...cantCustom].forEach(d => cant.appendChild(makeDishCard(d,'cat-cant', cantCustom.includes(d))));

  // Builtin soup + custom soup
  const soupCustom = customDishes.filter(d=>d.cat==='soup');
  [...BUILTIN_SOUP, ...soupCustom].forEach(d => soup.appendChild(makeDishCard(d,'cat-soup', soupCustom.includes(d))));

  // Other custom
  const otherCustom = customDishes.filter(d=>d.cat==='custom');
  if (otherCustom.length) {
    custom.style.display = 'block';
    otherCustom.forEach(d => custom.appendChild(makeDishCard(d,'cat-custom', true)));
  } else {
    custom.style.display = 'none';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATE BADGE & COUNTDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateDate() {
  const d = new Date();
  const DAYS  = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const MONTHS= ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  document.getElementById('dateBadge').textContent =
    `${DAYS[d.getDay()]}  ${d.getDate()} ${MONTHS[d.getMonth()]} ${d.getFullYear()}`;
  const midnight = new Date(d); midnight.setHours(24,0,0,0);
  const ms = midnight - d;
  const h=Math.floor(ms/3600000), m=Math.floor((ms%3600000)/60000);
  document.getElementById('resetTime').textContent =
    `Resets in ${h}h ${m}m Â· è·é›¢é‡è¨­ ${h}å°æ™‚${m}åˆ†`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAME + START
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startOrder() {
  const n = document.getElementById('nameIn').value.trim();
  if (!n) { toast('è«‹è¼¸å…¥åå­— Â· Enter your name'); document.getElementById('nameIn').focus(); return; }
  currentName = n;
  const phrases = ['ä½ å¥½','Hello','Hi there','å—¨','Hey'];
  const g = phrases[Math.floor(Math.random()*phrases.length)];
  document.getElementById('greeter').innerHTML = `${g}, <em>${n}</em>ï¼æ€ä½ æƒ³é£Ÿå˜…èœå¼ ğŸ‘‡`;
  document.getElementById('menuWrap').classList.add('on');
  const nr = document.getElementById('nameIn').closest('div');
  nr.style.opacity='.4'; nr.style.pointerEvents='none';
  document.getElementById('menuWrap').scrollIntoView({behavior:'smooth',block:'start'});
}
document.getElementById('nameIn').addEventListener('keydown', e=>{ if(e.key==='Enter') startOrder(); });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISH INTERACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggle(card) {
  card.classList.toggle('sel');
  const n = card.querySelector('.qnum');
  if (card.classList.contains('sel') && n.textContent==='0') n.textContent='1';
  updateSubmitBtn();
}
function adjQty(btn,d,e) {
  e.stopPropagation();
  const num = btn.closest('.dish-right').querySelector('.qnum');
  let v = parseInt(num.textContent)+d;
  if(v<1)v=1; if(v>9)v=9;
  num.textContent=v;
}
function sp(e){ e.stopPropagation(); }

function updateSubmitBtn() {
  const sel = document.querySelectorAll('.dish.sel');
  const btn = document.getElementById('subBtn');
  if (sel.length) {
    btn.disabled=false;
    btn.textContent=`ç¢ºèªè½å–® (${sel.length}æ¬¾) Â· Submit Order`;
  } else {
    btn.disabled=true;
    btn.textContent='è«‹é¸æ“‡èœå¼ Â· Select dishes first';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADD CUSTOM DISH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addCustomDish() {
  const emoji = document.getElementById('newEmoji').value.trim() || 'ğŸ½ï¸';
  const zh    = document.getElementById('newZh').value.trim();
  const en    = document.getElementById('newEn').value.trim();
  const cat   = document.getElementById('newCat').value;
  const sub   = document.getElementById('newSub').value.trim();

  if (!zh) { toast('è«‹è¼¸å…¥ä¸­æ–‡èœå Â· Enter dish name'); document.getElementById('newZh').focus(); return; }

  const id = 'custom_' + Date.now();
  const dish = {id, zh, en, emoji, cat, sub, isCustom:true};
  saveCustomDish(dish); // saves to Firebase; onSnapshot auto-updates menu

  ['newEmoji','newZh','newEn','newSub'].forEach(i => document.getElementById(i).value='');
  toast(`âœ… ã€Œ${zh}ã€å·²åŠ å…¥ä¸¦å„²å­˜ï¼Dish saved!`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DELETE CUSTOM DISH (modal confirm)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function askDeleteDish(e, id) {
  e.stopPropagation();
  pendingDeleteId = id;
  const d = customDishes.find(x=>x.id===id);
  document.getElementById('modalMsg').textContent =
    `ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤ã€Œ${d?.zh||id}ã€ï¼Ÿ\nThis dish will be permanently removed.`;
  document.getElementById('modalBg').classList.add('open');
}
function closeModal() {
  pendingDeleteId = null;
  document.getElementById('modalBg').classList.remove('open');
}
function confirmDeleteDish() {
  if (!pendingDeleteId) return;
  removeCustomDish(pendingDeleteId); // Firebase; onSnapshot auto-updates menu
  closeModal();
  toast('èœå¼å·²åˆªé™¤ Â· Dish removed');
}
document.getElementById('modalBg').addEventListener('click', e=>{
  if(e.target===document.getElementById('modalBg')) closeModal();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT ORDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitOrder() {
  const sel = document.querySelectorAll('.dish.sel');
  if (!sel.length || !currentName) return;
  const items=[];
  sel.forEach(card=>items.push({
    id:   card.dataset.id,
    qty:  parseInt(card.querySelector('.qnum').textContent),
    note: card.querySelector('.note-area').value.trim()
  }));
  const order = {
    id:   Date.now(),
    ts:   Date.now(),
    date: todayStr(),
    name: currentName,
    items,
    time: new Date().toLocaleTimeString('zh-HK',{hour:'2-digit',minute:'2-digit'})
  };
  saveOrder(order); // saves to Firebase; onSnapshot will update board automatically

  // reset form
  sel.forEach(c=>{
    c.classList.remove('sel');
    c.querySelector('.qnum').textContent='1';
    c.querySelector('.note-area').value='';
  });
  updateSubmitBtn();
  toast(`âœ… ${currentName} è½å–®æˆåŠŸï¼Order placed!`);
  setTimeout(()=>{
    currentName='';
    document.getElementById('nameIn').value='';
    const nr=document.getElementById('nameIn').closest('div');
    nr.style.opacity='1'; nr.style.pointerEvents='auto';
    document.getElementById('menuWrap').classList.remove('on');
    document.getElementById('nameIn').closest('.panel').scrollIntoView({behavior:'smooth',block:'start'});
  },700);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER ORDER BOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderBoard() {
  const DISHES    = buildDishMap();
  const popSec    = document.getElementById('popSection');
  const popList   = document.getElementById('popList');
  const ordersLbl = document.getElementById('ordersLbl');
  const oCards    = document.getElementById('orderCards');
  const empty     = document.getElementById('emptyState');
  const cookPanel = document.getElementById('cookPanel');
  const cookList  = document.getElementById('cookList');
  const meta      = document.getElementById('boardMeta');

  if (!orders.length) {
    popSec.style.display='none'; ordersLbl.style.display='none';
    oCards.innerHTML=''; empty.style.display='block';
    cookPanel.style.display='none'; meta.textContent='0 äºº';
    return;
  }
  empty.style.display='none';
  popSec.style.display='block';
  ordersLbl.style.display='block';
  meta.textContent=`${orders.length} äºº`;

  // Tally
  const totals={};
  orders.forEach(o=>o.items.forEach(it=>{ totals[it.id]=(totals[it.id]||0)+it.qty; }));
  const sorted = Object.entries(totals).sort((a,b)=>b[1]-a[1]);
  const maxQ   = sorted[0]?.[1]||1;

  // Popularity (top 7)
  popList.innerHTML = sorted.slice(0,7).map(([id,count])=>{
    const d=DISHES[id]||{emoji:'ğŸ½ï¸',zh:id};
    return `<div class="pop-item">
      <span class="pop-em">${d.emoji}</span>
      <span class="pop-name">${d.zh}</span>
      <div class="pop-bar-wrap"><div class="pop-bar" style="width:${Math.round(count/maxQ*100)}%"></div></div>
      <span class="pop-count">${count}</span>
    </div>`;
  }).join('');

  // Order cards
  oCards.innerHTML = orders.map(o=>`
    <div class="order-card">
      <button class="btn-del-order" onclick="deleteOrder(${o.id})">âœ•</button>
      <div class="order-person">ğŸ‘¤ ${o.name}</div>
      ${o.items.map(it=>{
        const d=DISHES[it.id]||{emoji:'ğŸ½ï¸',zh:it.id,en:''};
        return `<div class="oi-row">
          <span class="oi-em">${d.emoji}</span>
          <div class="oi-body">
            <div class="oi-name">${d.zh}<span style="font-size:.62rem;color:var(--muted);margin-left:.25rem">${d.en||''}</span></div>
            ${it.qty>1?`<div class="oi-qty">Ã— ${it.qty}</div>`:''}
            ${it.note?`<div class="oi-note">ğŸ“ ${it.note}</div>`:''}
          </div>
        </div>`;
      }).join('')}
      <div class="order-time">${o.time}</div>
    </div>`).join('');

  // Cook summary
  cookPanel.style.display='block';
  cookList.innerHTML = sorted.map(([id,count])=>{
    const d=DISHES[id]||{emoji:'ğŸ½ï¸',zh:id};
    return `<div class="cook-row">
      <span class="cook-name">${d.emoji} ${d.zh}</span>
      <span class="cook-qty">Ã— ${count}</span>
    </div>`;
  }).join('');
}

function deleteOrder(id) {
  removeOrder(id); // Firebase; onSnapshot auto-updates board
}
function clearAllOrders() {
  if(!orders.length) return;
  if(confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è¨‚å–®ï¼ŸClear all orders?')){
    clearTodayOrders();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toast(msg) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2800);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTO-RESET AT MIDNIGHT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function scheduleMidnightReset(db, ordersRef) {
  const now=new Date();
  const midnight=new Date(now); midnight.setHours(24,0,0,0);
  setTimeout(async ()=>{
    // purge yesterday's orders from Firestore
    const { query, where, getDocs, writeBatch } =
      await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
    const yesterday = (() => {
      const y=new Date(); y.setDate(y.getDate()-1);
      return `${y.getFullYear()}-${y.getMonth()+1}-${y.getDate()}`;
    })();
    const old = await getDocs(query(ordersRef, where('date','==',yesterday)));
    const batch = writeBatch(db);
    old.docs.forEach(d=>batch.delete(d.ref));
    await batch.commit();
    updateDate();
    scheduleMidnightReset(db, ordersRef);
  }, midnight-now);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPOSE FUNCTIONS TO GLOBAL SCOPE
   (required because script is type=module)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.startOrder       = startOrder;
window.toggle           = toggle;
window.adjQty           = adjQty;
window.sp               = sp;
window.addCustomDish    = addCustomDish;
window.askDeleteDish    = askDeleteDish;
window.closeModal       = closeModal;
window.confirmDeleteDish= confirmDeleteDish;
window.submitOrder      = submitOrder;
window.deleteOrder      = deleteOrder;
window.clearAllOrders   = clearAllOrders;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
updateDate();
setInterval(updateDate, 60000);
renderMenu();   // render with empty customDishes first; Firebase will update
renderBoard();  // render empty board; Firebase onSnapshot will populate
initFirebase(); // connect to Firebase
</script>
</body>
</html>
